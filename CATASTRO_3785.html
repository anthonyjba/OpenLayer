<!DOCTYPE html>
<html>
    <head>
    <title>MAPS: ZOOM by Spain Regions in OSM-GOOGLE-BING-CATASTRO</title>
    <style type="text/css">
        #map {
            width : 700px;
            height : 500px;
            border: 1px solid black;
        }
    </style>   
    </head>
    <body onload="init()">
        <div id="map"></div>
        <div id="coordinates"></div>
        <div>
            <strong>Coordenadas en EPSG:4258:</strong><br>
            <table cellspacing="0" rules="all" border="1" id="body_gvMBRs" style="border-collapse:collapse;">
                <tr>
                    <th scope="col">ID</th><th scope="col">DESCRIPCION</th><th scope="col">XMIN</th><th scope="col">YMIN</th><th scope="col">XMAX</th><th scope="col">YMAX</th>
                </tr><tr>
                    <td>1</td><td><a href="#" onclick="javascipt:HacerZoomMBR(1)"> Andaluc&#237;a</a></td>
                    <td><input type="text" id="xmin1" value="-7.52288340166718" /></td><td><input type="text" id="ymin1" value="35.9376147732038" /></td><td><input type="text" id="xmax1" value="-1.63011805254875" /></td><td><input type="text" id="ymax1" value="38.7290866785958" /></td>
                </tr><tr>
                    <td>2</td><td><a href="#" onclick="javascipt:HacerZoomMBR(2)">Arag&#243;n </a></td><td><input type="text" id="xmin2" value="-2.17367196489979" /></td><td><input type="text" id="ymin2" value="39.8467788691862" /></td><td><input type="text" id="xmax2" value="0.771307146036057" /></td><td><input type="text" id="ymax2" value="42.9244946039796" /></td>
                </tr><tr>
                    <td>3</td><td><a href="#" onclick="javascipt:HacerZoomMBR(3)">Principado De Asturias </a></td><td><input type="text" id="xmin3" value="-7.18248943552891" /></td><td><input type="text" id="ymin3" value="42.8825427290434" /></td><td><input type="text" id="xmax3" value="-4.51059393971278" /></td><td><input type="text" id="ymax3" value="43.6665322238003" /></td>
                </tr><tr>
                    <td>4</td><td><a href="#" onclick="javascipt:HacerZoomMBR(4)">Illes Balears </a></td><td><input type="text" id="xmin4" value="1.15727576431112" /></td><td><input type="text" id="ymin4" value="38.6403873725513" /></td><td><input type="text" id="xmax4" value="4.32778555387284" /></td><td><input type="text" id="ymax4" value="40.0945746332308" /></td>
                </tr><tr>
                    <td>5</td><td><a href="#" onclick="javascipt:HacerZoomMBR(5)">Canarias </a></td><td><input type="text" id="xmin5" value="-18.1613019830838" /></td><td><input type="text" id="ymin5" value="27.6378383465999" /></td><td><input type="text" id="xmax5" value="-13.3336411371433" /></td><td><input type="text" id="ymax5" value="29.4164996713826" /></td>
                </tr><tr>
                    <td>6</td><td><a href="#" onclick="javascipt:HacerZoomMBR(6)">Cantabria </a></td><td><input type="text" id="xmin6" value="-4.85173552710917" /></td><td><input type="text" id="ymin6" value="42.7580498571091" /></td><td><input type="text" id="xmax6" value="-3.14963461251159" /></td><td><input type="text" id="ymax6" value="43.5136930060637" /></td>
                </tr><tr>
                    <td>7</td><td><a href="#" onclick="javascipt:HacerZoomMBR(7)">Castilla Y Le&#243;n </a></td><td><input type="text" id="xmin7" value="-7.07705760880238" /></td><td><input type="text" id="ymin7" value="40.08245095674" /></td><td><input type="text" id="xmax7" value="-1.77536762888806" /></td><td><input type="text" id="ymax7" value="43.2386321832534" /></td>
                </tr><tr>
                    <td>8</td><td><a href="#" onclick="javascipt:HacerZoomMBR(8)">Castilla-La Mancha </a></td><td><input type="text" id="xmin8" value="-5.40618622087452" /></td><td><input type="text" id="ymin8" value="38.0224410614125" /></td><td><input type="text" id="xmax8" value="-0.91579121021141" /></td><td><input type="text" id="ymax8" value="41.3276312446158" /></td>
                </tr><tr>
                    <td>9</td><td><a href="#" onclick="javascipt:HacerZoomMBR(9)">Catalu&#241;a/Catalunya </a></td><td><input type="text" id="xmin9" value="0.159180537809438" /></td><td><input type="text" id="ymin9" value="40.5230464210379" /></td><td><input type="text" id="xmax9" value="3.33254220933324" /></td><td><input type="text" id="ymax9" value="42.8614503068152" /></td>
                </tr><tr>
                    <td>10</td><td><a href="#" onclick="javascipt:HacerZoomMBR(10)">Comunitat Valenciana </a></td><td><input type="text" id="xmin10" value="-1.52891592149883" /></td><td><input type="text" id="ymin10" value="37.843899489299" /></td><td><input type="text" id="xmax10" value="0.691227731765148" /></td><td><input type="text" id="ymax10" value="40.7886305047855" /></td>
                </tr><tr>
                    <td>11</td><td><a href="#" onclick="javascipt:HacerZoomMBR(11)">Extremadura </a></td><td><input type="text" id="xmin11" value="-7.54502554716887" /></td><td><input type="text" id="ymin11" value="37.9410265537103" /></td><td><input type="text" id="xmax11" value="-4.64757673698218" /></td><td><input type="text" id="ymax11" value="40.4866509322366" /></td>
                </tr><tr>
                    <td>12</td><td><a href="#" onclick="javascipt:HacerZoomMBR(12)">Galicia </a></td><td><input type="text" id="xmin12" value="-9.30150943414516" /></td><td><input type="text" id="ymin12" value="41.8074777126825" /></td><td><input type="text" id="xmax12" value="-6.73395283419991" /></td><td><input type="text" id="ymax12" value="43.7923794484717" /></td>
                </tr><tr>
                    <td>13</td><td><a href="#" onclick="javascipt:HacerZoomMBR(13)">Comunidad De Madrid </a></td><td><input type="text" id="xmin13" value="-4.57907624771634" /></td><td><input type="text" id="ymin13" value="39.8847195641724" /></td><td><input type="text" id="xmax13" value="-3.05298323184569" /></td><td><input type="text" id="ymax13" value="41.1658447182802" /></td>
                </tr><tr>
                    <td>16</td><td><a href="#" onclick="javascipt:HacerZoomMBR(16)">Pa&#237;s Vasco/Euskadi </a></td><td><input type="text" id="xmin16" value="-3.45032923648415" /></td><td><input type="text" id="ymin16" value="42.4722553075739" /></td><td><input type="text" id="xmax16" value="-1.72936875918178" /></td><td><input type="text" id="ymax16" value="43.4572461171874" /></td>
                </tr><tr>
                    <td>17</td><td><a href="#" onclick="javascipt:HacerZoomMBR(17)">La Rioja </a></td><td><input type="text" id="xmin17" value="-3.13427146691649" /></td><td><input type="text" id="ymin17" value="41.9190339431853" /></td><td><input type="text" id="xmax17" value="-1.67870140590047" /></td><td><input type="text" id="ymax17" value="42.6442647208234" /></td>
                </tr><tr>
                    <td>18</td><td><a href="#" onclick="javascipt:HacerZoomMBR(18)">Ciudad Aut&#243;noma De Ceuta</a></td><td><input type="text" id="xmin18" value="-5.42041229" /></td><td><input type="text" id="ymin18" value="35.16815045" /></td><td><input type="text" id="xmax18" value="-4.2954258" /></td><td><input type="text" id="ymax18" value="35.91738206" /></td>
                </tr><tr>
                    <td>19</td><td><a href="#" onclick="javascipt:HacerZoomMBR(19)">Ciudad Aut&#243;noma De Melilla"</a></td><td><input type="text" id="xmin19" value="-2.97031586" /></td><td><input type="text" id="ymin19" value="35.26545782" /></td><td><input type="text" id="xmax19" value="-2.92325951" /></td><td><input type="text" id="ymax19" value="35.3202884" /></td>
                </tr>
            </table>
        </div>

        <!-- OpenLayers core js -->
        <script src="http://www.openlayers.org/dev/OpenLayers.js"></script>

        <!-- OpenStreetMap base layer js -->
        <script src="http://www.openstreetmap.org/openlayers/OpenStreetMap.js"></script>

        <!-- Google Maps -->
        <script src="http://maps.google.com/maps/api/js?sensor=false"></script>

        <!-- Proj4js SpatialReference -->
        <script src="http://cdnjs.cloudflare.com/ajax/libs/proj4js/1.1.0/proj4js-compressed.js"></script>

        <script type="text/javascript">

        //Create Object OCMI config
        if (typeof Ocmi == "undefined" || !Ocmi) {
            var Ocmi = {};
        }

        //Asignar el crs para capas de OCMI
        Proj4js.defs["EPSG:4258"] = "+proj=longlat +ellps=GRS80 +no_defs";

        //Api para el mapa Bing
        var apiKey = "AqTGBsziZHIJYYxgivLBf0hVdrAk9mWO5cQcb8Yux8sW5M8c8opEC2lZqKR1ZZXf";

        //Map OL
        var map = null;

        function HacerZoomMBR(id) {
            var xmin = document.getElementById("xmin"+id).value;
            var ymin = document.getElementById("ymin"+id).value;
            var xmax = document.getElementById("xmax"+id).value;
            var ymax = document.getElementById("ymax"+id).value;

            if ((xmin + ymin + xmax + ymax) != 0) {
                var cooBotmLeft = new OpenLayers.LonLat(xmin, ymin);
                var cooTopRight = new OpenLayers.LonLat(xmax, ymax);

                Ocmi.currentMBR = new OpenLayers.Bounds(cooBotmLeft.lon, cooBotmLeft.lat, cooTopRight.lon, cooTopRight.lat).transform(Ocmi.projOcmiETRS89, map.getProjectionObject());
                map.zoomToExtent(Ocmi.currentMBR, true);
            }
            else {
                Ocmi.currentMBR = null;
                map.zoomToExtent(Ocmi.bounds);
            }
        }

        function getLayerCATASTRO() {
            var capa = new OpenLayers.Layer.WMS(
                'WMS Catastro',
                'http://ovc.catastro.meh.es/Cartografia/WMS/ServidorWMS.aspx', {
                    layers: 'PONENCIAS',
                    srs: 'EPSG:3785',
                    version: '1.1.1',
                    format: 'image/png',
                    transparent: true
                }, {
                    isBaseLayer: false,
                    transparent: true,
                    visibility: true,
                    buffer: 0,
                    singleTile: false,
                    ratio: 1.5
                });

            return capa;
        }


        function getLayerZonasValor() {
            var capa = new OpenLayers.Layer.WMS(
                    'Zonas Valor',
                    'http://localhost:49363/wms.ashx', {
                        layers: 'OCMI_ZONAVALOR4258',
                        service: 'wms',
                        version: '1.3.0',
                        format: 'image/png',
                        transparent: true
                    }, {
                        isBaseLayer: false,
                        transparent: true,
                        visibility: false,
                        buffer: 0,
                        singleTile: false,
                        ratio: 1.5
                    });

            var options = { wmsparams: {
                'MAP_TYPE': 'RECINTO'
            }
            };
            capa.mergeNewParams(options.wmsparams);

            //capa.events.register('loadstart', this, showLabelsCultivos);
            //capa.events.register('loadend', this, onloadend);

            return capa;
        }

        function init() {            
            'use strict'; // En esta función el modo estricto está activado

            // * SETUP object OCMI *
            //          
            // World Geodetic System 1984 projection
            Ocmi.projWGS84 = new OpenLayers.Projection("EPSG:4326");
            // ETRS89 OCMI projection            
            Ocmi.projOcmiETRS89 = new OpenLayers.Projection("EPSG:4258");
            // WGS84 Mercator projection
            Ocmi.projMercator = new OpenLayers.Projection("EPSG:3785");
            //Bounds Spain Map 
            Ocmi.bounds = new OpenLayers.Bounds(-1500000, 3950000, 520000, 5600000);
            //Resolutions Zoom
            Ocmi.resolutions = OpenLayers.Layer.Bing.prototype.serverResolutions.slice(5, 19);
            //Maxima Resolution
            Ocmi.maxResolution = 4891.9698095703125;
            //Actual BBOX
            Ocmi.currentMBR = null;

            /* INITIALIZE MAP */

            //creates a new openlayers map in the <div> html element id map
            map = new OpenLayers.Map ("map", {
                controls:[
                    //allows the user pan ability
                    new OpenLayers.Control.Navigation(),
                    //displays the pan/zoom bar tools
                    new OpenLayers.Control.PanZoomBar(),
                    //displays a layer switcher
                    new OpenLayers.Control.LayerSwitcher(),
                    //allows the user Zoom Window
                    new OpenLayers.Control.NavToolbar(),
                    //displays the scala line 
                    new OpenLayers.Control.ScaleLine(),
                    //displays the scala 
                    new OpenLayers.Control.Scale(),
                    //displays the mouse position's coordinates in a <div> html element with
                    new OpenLayers.Control.MousePosition({
                        div:document.getElementById("coordinates")
                    })
                ],
                    projection: Ocmi.projMercator,
                    displayProjection: Ocmi.projWGS84                    
            } );
            map.maxExtent = Ocmi.bounds;

            //Url OpenStreetMap
            var url = [
            "http://a.tile.openstreetmap.org/${z}/${x}/${y}.png",
            "http://b.tile.openstreetmap.org/${z}/${x}/${y}.png",
            "http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"
            ];
            
            //base layers
            var openstreetmap = new OpenLayers.Layer.OSM("OSM",url,{numZoomLevels: 19,isBaseLayer: true, displayInLayerSwitcher: true, zoomOffset: 5, resolutions: Ocmi.resolutions, attribution: "&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors, Tiles courtesy of <a href='http://www.opencyclemap.org'>Andy Allan</a>",buffer: 0, transitionEffect: "resize"});
            var google_maps = new OpenLayers.Layer.Google(
                "Google Maps", {
                    minZoomLevel: 4
                }
            );
            /*var google_satellite = new OpenLayers.Layer.Google(
                "Google Satellite", {
                    type: google.maps.MapTypeId.SATELLITE,
                    minZoomLevel: 4
                }
            );*/
            var bing = new OpenLayers.Layer.Bing({ name: "Bing Maps", type: "Road", key: apiKey, maxResolution: Ocmi.maxResolution, minZoomLevel: 4 });

            //Overlays Layers
            var wmsCAT = getLayerCATASTRO();
            var zonasValor = getLayerZonasValor();
            
            //Equal Projection
            openstreetmap.projection = google_maps.projection = bing.projection = wmsCAT.projection = zonasValor.projection = Ocmi.projMercator;

            //Add Layers to map
            map.addLayers([openstreetmap, google_maps, bing, wmsCAT, zonasValor]);

            //Zoom To Extent Ocmi's bounds 
            map.zoomToExtent(Ocmi.bounds);

            alert(map.getProjection());

            /* END MAP */

        }
        
        </script>

    </body>
</html>
